---
title: SQL 数据库审核日志格式 | Microsoft Docs
description: 了解 SQL 数据库审核日志的构建方式。
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: WenJason
ms.author: v-jay
ms.reviewer: vanto
manager: digimobile
origin.date: 01/03/2019
ms.date: 03/25/2019
ms.openlocfilehash: 894a03b2f9db0dbc0f2495717f6962a30aee1c3c
ms.sourcegitcommit: c4812614cd0af1b13f911895b6b0582f0b140886
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/14/2019
ms.locfileid: "67135571"
---
# <a name="sql-database-audit-log-format"></a>SQL 数据库审核日志格式

[Azure SQL 数据库审核](sql-database-auditing.md)跟踪数据库事件，并将事件写入 Azure 存储帐户中的审核日志。

## <a name="naming-conventions"></a>命名约定

### <a name="blob-audit"></a>Blob 审核

Blob 存储中存储的审核日志存储在 Azure 存储帐户中名为 `sqldbauditlogs` 的容器内。 该容器中的目录层次结构采用 `<ServerName>/<DatabaseName>/<AuditName>/<Date>/` 格式。 Blob 文件名的格式为 `<CreationTime>_<FileNumberInSession>.xel`，其中，`CreationTime` 采用 UTC `hh_mm_ss_ms` 格式，`FileNumberInSession` 是运行的索引（如果会话日志跨多个 Blob 文件）。

例如，对于 `Server1` 上的数据库 `Database1`，下面是可能的有效路径：

    Server1/Database1/SqlDbAuditing_ServerAudit_NoRetention/2019-02-03/12_23_30_794_0.xel

## <a id="subheading-1"></a>审核日志字段

|          名称 (Blob)           |                                                                                                                                                 说明                                                                                                                                                 |                            Blob 类型                            |
|--------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|           action_id            |                                                                                                                                                                                                                                                                                                             |                        操作的 ID                         | varchar(4) |
|          action_name           |                                                                                                                                                                                                                                                                                                             |                       操作的名称                        | 不适用 |
|     additional_information     |                                                                                                                          有关事件的任何附加信息，以 XML 形式存储                                                                                                                          |                         nvarchar(4000)                          |
|         affected_rows          |                                                                                                                                    查询影响的行数                                                                                                                                     |                             bigint                              |
|        application_name        |                                                                                                                                         客户端应用程序的名称                                                                                                                                          |                          nvarchar(128)                          |
|      audit_schema_version      |                                                                                                                                                  始终为 1                                                                                                                                                   |                               int                               |
|           class_type           |                                                                                                                              发生审核的可审核实体的类型                                                                                                                              |                           varchar(2)                            |
|        class_type_desc         |                                                                                                                          发生审核的可审核实体的说明                                                                                                                           |                               不适用                               |
|           client_ip            |                                                                                                                                     客户端应用程序的源 IP                                                                                                                                     |                          nvarchar(128)                          |
|         connection_id          |                                                                                                                                     服务器中的连接的 ID                                                                                                                                      |                              GUID                               |
|  data_sensitivity_information  |                             受审核查询根据数据库中分类的列返回的信息类型和敏感度标签。 详细了解 [Azure SQL 数据库数据发现和分类](sql-database-data-discovery-and-classification.md)                              |                         nvarchar(4000)                          |
|         database_name          |                                                                                                                              在其中执行操作的数据库上下文                                                                                                                              |                             sysname                             |
|     database_principal_id      |                                                                                                                                           database_principal_id_d                                                                                                                                           | 在其中执行操作的数据库用户上下文的 ID | int |
|    database_principal_name     |                                                                                                                     在其中执行操作的数据库用户上下文的名称                                                                                                                      |                             sysname                             |
|     duration_milliseconds      |                                                                                                                                  查询执行持续时间，以毫秒为单位                                                                                                                                   |                             bigint                              |
|           event_time           |                                                                                                                              激发可审核操作的日期和时间                                                                                                                               |                            datetime2                            |
|           host_name            |                                                                                                                                              客户端主机名                                                                                                                                               |                             字符串                              |
|      is_column_permission      |                                                                                                                  指示是否为列级权限的标志。 1 = true，0 = false                                                                                                                  |                               bit                               |
|              不适用               |                                                                                                                            指示此项审核是否在服务器级别发生的标志                                                                                                                             |                               不适用                               |
|           object_id           |                                       发生审核的实体的 ID。 包括：服务器对象、数据库、数据库对象和架构对象。 如果实体是服务器本身，或者审核不是在对象级别执行的，则值为 0                                       |                               int                               |
|          object_name           |                                      发生审核的实体的名称。 包括：服务器对象、数据库、数据库对象和架构对象。 如果实体是服务器本身，或者审核不是在对象级别执行的，则值为 0                                      |                             sysname                             |
|       permission_bitmask       |                                                                                                                在适用的情况下，显示已授予、已拒绝或已撤销的权限                                                                                                                 |                          varbinary(16)                          |
|         response_rows          |                                                                                                                                  在结果集中返回的行数                                                                                                                                  |                             bigint                              |
|          schema_name           |                                                                                                         在其中执行操作的架构上下文。 如果审核在架构外部发生，则值为 NULL                                                                                                         |                             sysname                             |
|              不适用               |                                                                                                                         映射到正在审核的 class_type 的安全对象                                                                                                                          |                               不适用                               |
|       sequence_group_id        |                                                                                                                                              唯一标识符                                                                                                                                              |                            varbinary                            |
|        sequence_number         |                                                                                            跟踪大小过大、以致无法装入审核写入缓冲区的单个审核记录中的记录序列                                                                                             |                               int                               |
|      server_instance_name      |                                                                                                                            发生审核的服务器实例的名称                                                                                                                             |                             sysname                             |
|      server_principal_id       |                                                                                                                          在其中执行操作的登录上下文的 ID                                                                                                                           |                               int                               |
|     server_principal_name      |                                                                                                                                                当前登录名                                                                                                                                                |                             sysname                             |
|      server_principal_sid      |                                                                                                                                              当前登录名 SID                                                                                                                                              |                            varbinary                            |
|           session_id           |                                                                                                                                发生事件的会话的 ID                                                                                                                                |                            smallint                             |
| session_server_principal_name  |                                                                                                                                        会话的服务器主体                                                                                                                                         |                             sysname                             |
|           statement            |                                                                                                                                 执行的 T-SQL 语句（如果有）                                                                                                                                  |                         nvarchar(4000)                          |
|           succeeded            |                                            指示触发事件的操作是否成功。 对于除登录和批处理以外的事件，此字段仅报告权限检查是成功还是失败，而不会报告操作结果。 1 = 成功，0 = 失败                                            |                               bit                               |
|  target_database_principal_id  |                                                                                                         执行 GRANT/DENY/REVOKE 操作的数据库主体。 如果不适用，则值为 0                                                                                                         |                               int                               |
| target_database_principal_name |                                                                                                                                操作的目标用户。 如果不适用，则值为 NULL                                                                                                                                |                             字符串                              |
|   target_server_principal_id   |                                                                                                     执行 GRANT/DENY/REVOKE 操作的服务器主体。 如果不适用，则返回 0                                                                                                      |                               int                               |
|  target_server_principal_name  |                                                                                                                               操作的目标登录名。 如果不适用，则值为 NULL                                                                                                                                |                             sysname                             |
|  target_server_principal_sid   |                                                                                                                                 目标登录名的 SID。 如果不适用，则值为 NULL                                                                                                                                 |                            varbinary                            |
|         transaction_id         |                                                                                                                          仅适用于 SQL Server（2016 和更高版本）- 对于 Azure SQL 数据库，值为 0                                                                                                                          |                             bigint                              |
|     user_defined_event_id      |  用户定义的事件 ID，作为参数传递给 sp_audit_write。 对于系统事件，值为 NULL（默认值）；对于用户定义的事件，值为非零值。 有关详细信息，请参阅 [sp_audit_write (Transact-SQL)](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-audit-write-transact-sql)   |                            smallint                             |
|    user_defined_information    | 用户定义的信息，作为参数传递给 sp_audit_write。 对于系统事件，值为 NULL（默认值）；对于用户定义的事件，值为非零值。 有关详细信息，请参阅 [sp_audit_write (Transact-SQL)](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-audit-write-transact-sql) |                         nvarchar(4000)                          |

## <a name="next-steps"></a>后续步骤

详细了解 [Azure SQL 数据库审核](sql-database-auditing.md)。